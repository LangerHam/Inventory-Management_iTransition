@model IEnumerable<Inventory_Management_iTransition.ViewModel.UserViewModel>
@using Microsoft.AspNet.Identity
@{
    ViewBag.Title = "Admin Panel - User Management";
    Layout = "~/Views/Shared/_Layout.cshtml";
    var currentUserId = User.Identity.GetUserId();

}

<div class="container mt-4">
    <h2 class="mb-4">@ViewBag.Title</h2>

    <div class="card">
        <div class="card-body">
            <table class="table table-hover align-middle">
                <thead>
                    <tr>
                        <th>User Email</th>
                        <th>Status</th>
                        <th>Role</th>
                        <th class="text-end">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var user in Model)
                    {
                        <tr>
                            <td><strong>@user.Email</strong></td>
                            <td>
                                @if (user.IsBlocked)
                                {
                                    <span class="badge bg-danger">Blocked</span>
                                }
                                else
                                {
                                    <span class="badge bg-success">Active</span>
                                }
                            </td>
                            <td>
                                @if (user.IsAdmin)
                                {
                                    <span class="badge bg-primary">Admin</span>
                                }
                                else
                                {
                                    <span class="badge bg-secondary">User</span>
                                }
                            </td>
                            <td class="text-end">
                                <div class="btn-group" role="group">

                                    <!-- Block/Unblock Form -->
                                    @if (user.IsBlocked)
                                    {
                                        using (Html.BeginForm("Unblock", "Admin", new { id = user.Id }, FormMethod.Post, new Dictionary<string, object> { { "class", "d-inline" } }))
                                        {
                                            @Html.AntiForgeryToken()
                                            <button type="submit" class="btn btn-sm btn-outline-success">Unblock</button>
                                        }
                                    }
                                    else
                                    {
                                        using (Html.BeginForm("Block", "Admin", new { id = user.Id }, FormMethod.Post, new Dictionary<string, object> { { "class", "d-inline" } }))
                                        {
                                            @Html.AntiForgeryToken()
                                            <button type="submit" class="btn btn-sm btn-outline-warning">Block</button>
                                        }
                                    }

                                    <!-- Admin Role Form -->
                                    @if (user.IsAdmin)
                                    {
                                        using (Html.BeginForm("RemoveAdmin", "Admin", new { id = user.Id }, FormMethod.Post, new Dictionary<string, object> { { "class", "d-inline" } }))
                                        {
                                            @Html.AntiForgeryToken()
                                            <button type="submit" class="btn btn-sm btn-outline-secondary">Remove Admin</button>
                                        }
                                    }
                                    else
                                    {
                                        using (Html.BeginForm("MakeAdmin", "Admin", new { id = user.Id }, FormMethod.Post, new Dictionary<string, object> { { "class", "d-inline" } }))
                                        {
                                            @Html.AntiForgeryToken()
                                            <button type="submit" class="btn btn-sm btn-outline-primary">Make Admin</button>
                                        }
                                    }

                                    <!-- Delete Form -->
                                    @using (Html.BeginForm("Delete", "Admin", new { id = user.Id }, FormMethod.Post, new Dictionary<string, object> { { "class", "d-inline" } }))
                                    {
                                        @Html.AntiForgeryToken()
                                        <button type="submit" class="btn btn-sm btn-danger"
                                                @(user.Id == currentUserId ? "disabled" : "")
                                                onclick="return confirm('Are you sure you want to delete this user? This action cannot be undone.');">
                                            Delete
                                        </button>
                                    }
                                </div>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>

